@model int
@{
    ViewBag.Title = "Deatils";
    Layout = "~/Areas/App/Views/Shared/_Layout.cshtml";
}

@section vendorStyle{

    <link href="../../assets/vendor/libs/node-waves/node-waves.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/typeahead-js/typeahead.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/animate-css/animate.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/sweetalert2/sweetalert2.css" rel="stylesheet" />
    <link href="../../assets/vendor/libs/select2/select2.css" rel="stylesheet" />
    <link rel="stylesheet" href="@Url.Content("~/assets/vendor/libs/@form-validation/form-validation.css")" />
    <link href="../../assets/vendor/css/pages/page-user-view.css" rel="stylesheet" />
}

<h4 class="py-3 mb-4">
    <span class="text-muted fw-light">مشاهده کاربر/</span>
    حساب کاربری
</h4>
<div class="row">
    <!-- User Sidebar -->
    <div class="col-xl-4 col-lg-5 col-md-5 order-1 order-md-0">
        <!-- User Card -->
        @Html.Action("_UserCard", "Admin", new { area = "App", userid = Model })
        <!-- /User Card -->
        <!-- /Plan Card -->
    </div>
    <!--/ User Sidebar -->
    <!-- User Content -->
    <div class="col-xl-8 col-lg-7 col-md-7 order-0 order-md-1">
        <!-- User Pills -->
        <ul class="nav nav-pills flex-column flex-md-row mb-4">
            <li class="nav-item">
                @if (ViewBag.Type == "history")
                {
                    <a class="nav-link active" href="@Url.Action("Details","Admin",new {area="App",type="history",user_id=Model})">
                        <i class="ti ti-users ti-xs me-1"></i>
                        تاریخچه
                    </a>
                }
                else
                {
                    <a class="nav-link" href="@Url.Action("Details","Admin",new {area="App",type="history",user_id=Model})">
                        <i class="ti ti-users ti-xs me-1"></i>
                        تاریخچه
                    </a>
                }
            </li>
            <li class="nav-item">
                @if (ViewBag.Type == "Factors")
                {
                    <a class="nav-link active" href="@Url.Action("Details","Admin",new {area="App",type="Factors",user_id=Model})">
                        <i class="ti ti-cash ti-xs me-1"></i>
                        فاکتور ها
                    </a>
                }
                else
                {
                    <a class="nav-link" href="@Url.Action("Details","Admin",new {area="App",type="Factors",user_id=Model})">
                        <i class="ti ti-cash ti-xs me-1"></i>
                        فاکتور ها
                    </a>
                }
            </li>
        </ul>

        <!--/ User Pills -->
        <!-- Invoice table -->
        <div class="card mb-4">
            <div class="table-responsive mb-3">
                @if (ViewBag.Type == "history")
                {
                    <table class="table datatable-sub border-top">
                        <thead>
                            <tr>
                                <th></th>
                                <th>نام اشتراک</th>
                                <th>رویداد</th>
                                <th>تاریخ ایجاد</th>
                                <th>مبلغ فروش</th>
                                <th>تعرفه</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                    </table>
                }
                else if (ViewBag.Type == "Factors")
                {
                    <table class="table datatable-invoice border-top">
                        <thead>
                            <tr>
                                <th></th>
                                <th>تاریخ پرداخت</th>
                                <th>مبلغ پرداختی</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                    </table>
                }
            </div>
        </div>
        <!-- /Invoice table -->
        <!-- Activity Timeline -->
    </div>
    <!--/ User Content -->
</div>
@{
    var Role = Request.Cookies["Role"].Value;
}

<!-- Modal -->
<!-- Edit Setting Modal -->

@if (Role == "1")
{

    @Html.Action("_GetSetting", "Admin", new { area = "App", user_id = Model })
}
<!--/ Edit Setting Modal -->
<!-- Edit Wallet Modal -->
@Html.Action("_EditWallet", "Admin", new { area = "App", user_id = Model })

<!--/ Edit Wallet Modal -->


@section vendorScripts {

    <script src="../../assets/vendor/libs/moment/moment.js"></script>
    <script src="../../assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
    <script src="../../assets/vendor/libs/datatables-bs5/i18n/fa.js"></script>
    <script src="../../assets/vendor/libs/sweetalert2/sweetalert2.js"></script>
    <script src="../../assets/vendor/libs/typeahead-js/typeahead.js"></script>
    <script src="../../assets/vendor/libs/cleavejs/cleave.js"></script>
    <script src="../../assets/vendor/libs/cleavejs/cleave-phone.js"></script>
    <script src="../../assets/vendor/libs/select2/select2.js"></script>
    <script src="../../assets/vendor/libs/select2/i18n/fa.js"></script>
    <script src="@Url.Content("~/assets/vendor/libs/@form-validation/popular.js")"></script>
    <script src="@Url.Content("~/assets/vendor/libs/@form-validation/bootstrap5.js")"></script>
    <script src="@Url.Content("~/assets/vendor/libs/@form-validation/auto-focus.js")"></script>
    <script src="../../assets/vendor/libs/block-ui/block-ui.js"></script>
}


@section customScripts {

    <script src="../../assets/js/modal-edit-wallet.js"></script>
    <script src="../../assets/js/app-user-view.js"></script>
    <script src="../../assets/js/app-user-view-account.js"></script>


    <script>
        $(function () {

            $("#group").wrap('<div class="position-relative"></div>').select2({
                placeholder: 'انتخاب گروه مجوز',
                dropdownParent: $("#group").parent(),
                allowClear: false
            });

            Groups("#group");

        });

        function SelectGroup(selectId, Ids) {
            console.log("select shod");
            $(selectId).val(Ids).trigger('change');
        }

        function Groups(selectId) {
            console.log("omad");
            var $select = $(selectId);
            $.ajax({
                url: "/App/Plan/GetSelectGroups",
                type: "get",
                dataType: "json",
                async: true,
                success: function (res) {
                    console.log(res);
                    // پاک کردن گزینه‌های قبلی
                    $select.empty();

                    // افزودن گزینه‌های جدید
                    $.each(res.data, function (index, item) {
                        var newOption = new Option(item.Name, item.id, false, false);
                        $select.append(newOption);
                    });
                },
                error: function (xhr, status, error) {
                    console.error("An error occurred: " + status + " " + error);
                }
            });

        }


        $("#SaveGroup").click(function () {

            $("#user_id").val(getUrlParameter("user_id"));

            AjaxFormPost("/App/Admin/SetSetting", "#editGroupForm").then(res => {


                eval(res.data);
                if (res.status == "success") {
                    $("#editSetting").modal("hide");
                }

            });

        });


        $("#ZeroWallet").click(function () {

            $("#Deposit").val(0);

        });

        $("#SaveDeposit").click(function () {

            $("#user_id").val(getUrlParameter("user_id"));

            AjaxFormPost("/App/Admin/EditWallet", "#editWalletForm").then(res => {


                eval(res.data);
                if (res.status == "success") {
                    $("#editWallet").modal("hide");
                }

            });

        });


        function ChangeAgent(inp) {
            var Check = $(inp).is(':checked');
            var user_id = '@Model';
            BodyBlockUI();
            $.ajax({
                url: "@Url.Action("ChangeAgent","Admin")",
                type: "Post",
                dataType: "json",
                data: { status: Check, user_id: user_id },
                success: function (res) {
                    BodyUnblockUI();
                    if (res.status != "success") {
                        eval(res.data);
                        $(inp).prop("checked", false);
                    }

                }
            });


        }
    </script>

}